# План рефакторингу UI

## Аналіз поточного стану

### Проблеми:
1. **MainWindow надто великий** (1000+ рядків)
   - Змішана логіка UI та бізнес-логіки
   - Багато різних відповідальностей
   - Складно підтримувати та тестувати

2. **Відсутність сервісного шару**
   - Бізнес-логіка розкидана по UI компонентах
   - Важко перевикористовувати код
   - Ускладнене тестування

3. **Дублювання коду**
   - Повторювана логіка обробки індексів
   - Дублювання стилів
   - Повторювані патерни

4. **Слабка документація**
   - Не всі методи задокументовані
   - Відсутні docstrings
   - Немає коментарів для складної логіки

## Архітектура після рефакторингу

```
ui/
├── main_window.py           # Головне вікно (300-400 рядків)
├── managers/                # Менеджери бізнес-логіки
│   ├── __init__.py
│   ├── file_manager.py      # Робота з файлами
│   ├── search_manager.py    # Пошук адрес
│   ├── processing_manager.py # Авто/напів-авто обробка
│   └── ui_state_manager.py  # Управління станом UI
├── widgets/                 # UI компоненти
│   ├── __init__.py
│   ├── toolbar_panel.py     # Верхня панель інструментів
│   ├── table_panel.py       # Панель з таблицею
│   ├── address_selector_panel.py (існує)
│   ├── results_panel.py     (існує)
│   ├── column_mapping_dialog.py (існує)
│   └── auto_processing_dialog.py (існує)
├── styles/                  # Стилі
│   ├── __init__.py
│   └── styles.py            # Централізовані стилі
└── utils/                   # UI утиліти
    ├── __init__.py
    └── validators.py        # Валідація даних
```

## Етапи рефакторингу

### Етап 1: Створення базових менеджерів ✅
- [x] Створити структуру директорій
- [ ] FileManager - управління файлами
- [ ] SearchManager - пошук та індексація
- [ ] ProcessingManager - автообробка
- [ ] UIStateManager - стан інтерфейсу

### Етап 2: Розділення MainWindow ✅
- [ ] Винести верхню панель в ToolbarPanel
- [ ] Винести таблицю в TablePanel
- [ ] Зменшити MainWindow до 300-400 рядків
- [ ] Делегувати логіку менеджерам

### Етап 3: Стилізація ✅
- [ ] Створити centralized styles
- [ ] Уніфікувати кольори та шрифти
- [ ] Створити константи для стилів
- [ ] Застосувати єдиний стиль

### Етап 4: Документація ✅
- [ ] Додати docstrings до всіх класів
- [ ] Документувати публічні методи
- [ ] Додати коментарі до складної логіки
- [ ] Створити README для UI модуля

### Етап 5: Оптимізація ✅
- [ ] Видалити дублювання коду
- [ ] Оптимізувати важкі операції
- [ ] Покращити обробку помилок
- [ ] Додати type hints

### Етап 6: Тестування ✅
- [ ] Перевірити всі функції
- [ ] Тестування інтеграції
- [ ] Перевірка продуктивності
- [ ] Фінальне тестування

## Приклад рефакторингу

### До:
```python
class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.excel_handler = ExcelHandler()
        self.search_engine = HybridSearch()
        # 50+ рядків ініціалізації
        
    def load_excel_file(self):
        # 80 рядків коду
        
    def save_excel_file(self):
        # 60 рядків коду
        
    def search_address(self):
        # 40 рядків коду
```

### Після:
```python
class MainWindow(QMainWindow):
    """Головне вікно програми - координатор компонентів"""
    
    def __init__(self):
        super().__init__()
        self.file_manager = FileManager()
        self.search_manager = SearchManager()
        self.processing_manager = ProcessingManager()
        self.ui_state = UIStateManager()
        
        self._init_ui()
        self._connect_signals()
        
    def load_excel_file(self):
        """Завантажує Excel файл через FileManager"""
        file_path = self.file_manager.get_file_path()
        if file_path:
            self.file_manager.load(file_path)
            self.ui_state.update_file_loaded(file_path)
```

## Переваги після рефакторингу

### 1. Читабельність ✅
- Менші файли - легше читати
- Чітке розділення відповідальностей
- Логічна структура

### 2. Підтримуваність ✅
- Легше знаходити баги
- Простіше додавати функції
- Ізольовані зміни

### 3. Тестування ✅
- Менеджери можна тестувати окремо
- UI тести простіші
- Mock'и легко створювати

### 4. Масштабованість ✅
- Легко додавати нові функції
- Можна замінювати компоненти
- Готово до розширення

## Часові оцінки

- Етап 1: 2-3 години
- Етап 2: 3-4 години  
- Етап 3: 1-2 години
- Етап 4: 2-3 години
- Етап 5: 2-3 години
- Етап 6: 1-2 години

**Загалом: 11-17 годин**

## Ризики

1. **Регресія** - можливі нові баги
   - Мітигація: поетапне тестування
   
2. **Зміна поведінки** - UI може змінитися
   - Мітигація: збереження функціональності
   
3. **Час розробки** - більше часу ніж очікується
   - Мітигація: поетапний підхід

## Критерії успіху

✅ MainWindow < 400 рядків
✅ Всі класи мають docstrings
✅ Немає дублювання коду > 5 рядків
✅ Єдиний стиль для всіх компонентів
✅ Всі функції працюють як раніше
✅ Покращена продуктивність
